엔티티 매니저를 이해하기 전에 먼저 `영속성 컨텍스트`에 대해 먼저 알아야 한다.

영속성 컨텍스트는 엔티티를 관리하는 1차 캐시로,

- 1차 캐싱
- 쓰기 지연
- 변경 감지
를 통해 엔티티 생명 주기를 관리하고 DB 동기화, 효율적인 영속 관리를 가능하게 해준다.

> 이 영속성 컨텍스트를 관리하는 작업을 도와주는 것이 바로 '엔티티 매니저'다.

엔티티 매니저는 엔티티 상태를 변경하고, 영속성 컨텍스트와 상호작용함으로써 영속 로직을 수행하는 역할을 한다.

엔티티는 영속성 컨텍스트와 관련하여 4가지 상태 (영속, 비영속, 준영속, 삭제)를 가질 수 있다.
이는 엔티티 매니저의 `persist`, `merge`, `remove`, `close` 메서드를 이용하면 된다.

또한, 엔티티 매니저는 영속성 컨텍스트의 1차 캐시로부터 엔티티를 조회할 수 있으며, 쓰기 지연 저장소에 있는 쿼리들을 `flush`하여 DB와 동기화 한다.

### 비영속 상태

```java
Member member = new Member();
```

- 객체가 생성되었지만, 영속성 컨텍스트에는 등록되지 않은 상태
- DB와 전혀 관계 없으며, 메모리 상에만 존재

### 영속 상태

```java
em.persist(member);
```

- member 객체가 영속성 컨텍스트에 의해 관리되고 있는 상태
- 엔티티의 변경 사항이 생기면 자동으로 DB에 반영

### 준영속 상태

```java
em.detach(member);
```

-  엔티티 객체가 한 번 이상 영속성 컨텍스트에 의해 관리된 적이 있지만, 현재는 분리된 상태
-  식별자를 갖고 있다.
-  비영속 상태와 마찬가지로 DB와 동기화 되지 않는다.

### 삭제 상태

```java
em.remove(member);
```

- 엔티티 객체가 영속성 컨텍스트에서 제거된 상태
- 삭제가 되면 데이터베이스에서도 엔티티가 삭제된다.

---

> 💡 비영속 상태와 준영속 상태는 모두 DB와 동기화 되지 않고, 영속성 컨텍스트에 존재하지 않는다는 점에서 같다고 볼 수 있을 것 같은데 왜 상태를 따로 분류해 놓았나?


엔티티의 생명주기 동안 일어날 수 있는 다양한 시나리오를 보다 명확하게 설명하고 관리할 수 있게 하기 위함이다.

예를 들어, 준영속 상태의 엔티티를 다시 영속성 컨텍스트에 결합하려면 merge를 이용하여 DB와 동기화 할 수 있지만, 비영속 상태의 엔티티는 처음부터 영속 상태로 전환해야 한다.

영속 상태가 되어 본 경험이 있는 준영속 상태의 엔티티는 식별자를 아직 영속성 컨텍스트에서 가지고 있다.

